name: Extension CI (plan stub)

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  build-and-test:
    strategy:
      fail-fast: false
      matrix:
        os: [ubuntu-latest, macos-latest]
        node: [18, 20]
    runs-on: ${{ matrix.os }}
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      - name: Setup Node
        uses: actions/setup-node@v4
        with:
          node-version: ${{ matrix.node }}
          # cache disabled because repository does not commit a lockfile
      - name: Install
        run: |
          if [ -f package.json ]; then
            if [ -f package-lock.json ]; then
              npm ci
            else
              echo "No lockfile found; running npm install (no-audit, no-fund)"
              npm install --no-audit --no-fund
            fi
          else
            echo "No package.json (stub)"
          fi
      - name: Tests (docs/unit stub)
        run: |
          echo "Run doc-based tests (spec files) - stub"
          ls -R tests || true
      - name: Lint
        run: |
          if [ -f package.json ]; then npm run lint --if-present; else echo "no lint (stub)"; fi
      - name: Build
        run: |
          if [ -f package.json ]; then npm run build --if-present; else echo "no build (stub)"; fi
      - name: Upload artifact
        uses: actions/upload-artifact@v4
        with:
          name: extension-dist-${{ matrix.os }}-node${{ matrix.node }}
          path: extension/dist
          if-no-files-found: ignore

# TICKET-510: Style Eval Guard (documentation stub)
# - name: Style Eval
#   run: node scripts/style_eval.mjs --manifest tests/style/fixtures/dataset_manifest.json | tee style_report.json
# - name: Check thresholds
#   run: |
#     node -e 'const r=require("./style_report.json"); if(r.composite<0.65) { console.error("Style drift detected"); process.exit(1) }'


